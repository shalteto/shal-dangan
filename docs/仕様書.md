# 弾台帳アプリ

Google apps script(GAS)でGoogleスプレッドシートへの入力アプリを作ります。
GASはスプレッドシートにマウントされている前提です。

## 目的

- メインのデータシート（シート名: `main`）は猟銃の弾の購入及び消費記録を取ります。残弾数は、このシートの全記録（購入数 - 消費数）を動的に計算して算出します。
- 購入時および消費時は、用途（射撃、狩猟、有害鳥獣駆除）ごとおよび弾の大きさと種類（後述）ごとに数量、購入店名または消費場所および日付を記録します。
- 消費時はさらに消費した銃（自分が所有している銃からオプション選択）を指定します。狩猟または有害鳥獣駆除の用途でありかつ捕獲した個体があれば備考に記録します。
- 空気銃は使用弾数のみ記録し、購入数や残弾数の管理はしません（消費記録自体は他の銃と同じ`main`テーブルに行います）。

## 技術スタック(UI)

- Bootstrapを使用

## 機能

- データ入力は、購入時と消費時でUI構造を変えます。
- 「消費」をデフォルトとして、トップバーで「購入」「用途変更」「設定」に切り替え可能とする。

- 消費：
  - 日付、用途を入力。
  - 消費場所を入力：用途が射撃の場合は、`place`テーブルの"type=射撃場"でフィルターした`place`をオプションとして選ぶ（リストボックス）。用途が狩猟または有害鳥獣駆除ならテキスト入力する。
  - 捕獲個体があれば入力。
  - gun(使用銃)を選択：gunからオプション（リストボックス）
  - gunに対応する弾種のうち残弾がある弾種と残弾数を表示。弾種列の右隣に`quantity`入力列があるイメージ。`quantity`はテキスト入力でなく、[+1],[-1] ボタンで増減させる形式とする。
  - 確定ボタンを押して入力完了。複数の弾種を入力した場合、`main`シートには弾種ごとに別の行として保存します。
  
- 用途変更：
  - トップバーで「用途変更」を選択。
  - **変更元(From)**:
    - 用途を選択（射撃/狩猟/駆除など）。
    - 銃を選択（その銃の、その用途での残弾がある弾種のみ表示）。
    - 弾種を選択。現在の残弾数を表示。
  - **変更先(To)**:
    - 用途を選択。※変更元と同じ用途は選択不可。
  - **数量(Quantity)**:
    - 移動する弾数を入力（変更元の残弾数以下であること）。
  - **実行**:
    - `main`シートに2行追加される。
      1. `quantity`: マイナス値（変更元用途からの出庫）
      2. `quantity`: プラス値（変更先用途への入庫）
    - `place` は "-" (ハイフン) として記録される。

- 設定：
  - トップバーで「設定」を選択。
  - 編集対象のマスタテーブルを選択（`gun`, `bullet_type`, `place`, `use`）。
  - 各テーブルのデータを一覧表示。
  - **追加**: 新規行を追加可能。
  - **削除**: 既存行を削除可能。
  - **編集**: 既存セルの値を直接編集可能（または削除して追加）。
  - ※ここでの変更はアプリのマスタデータロードに即時反映されること。

- 購入：
  - トップバーで購入を押下
  - 日付、購入店名を指定。購入店名は`place`テーブルの"type=銃砲店"でフィルターした`place`をオプションとして選ぶ（リストボックス）。
  - **用途**を指定（必須）。`use`テーブルから選択。
  - gun(使用銃)を選択：gunからオプション（リストボックス）。空気銃は選択肢から除外すること。
  - gunに対応する弾種を表示。弾種列の右隣に`quantity`入力列があるイメージ。`quantity`はテキスト入力でなく、[+10],[+1],[-1],[-10]ボタンなどで増減させる形式とする。
  - 確定ボタンを押して入力完了。複数の弾種を入力した場合、`main`シートには弾種ごとに別の行として保存します。

## DBテーブルのフィールド

|項目名／説明|型|
|------------|----|
|date／購入または消費した日付|date|
|use／弾の用途|str|
|bullet_type／弾種類をオプション選択|str|
|category／弾種のカテゴリ（bullet_typeテーブルから自動取得）|str|
|quantity／購入または消費した数値|int|
|place／購入した店名または消費場所|str|
|gun／消費したときの銃|str|
|note／任意形式で記載|str|

## オプションの指定

### bullet type

`bullet_type`シートの`bullet_type`テーブルの`bullet_type`フィールドから選択する。
`gun`テーブルの`size`（口径）と一致する`size`を持つ`bullet_type`をフィルターして表示・選択肢とする。

`bullet_type`テーブルの例：

|bullet_type|size|type|category|
|-----------|----|----|--------|
|12番/スラグ|12番|スラグ|12番/スラグ|
|12番/BB|12番|BB|12番/散弾|
|12番/3号|12番|3号|12番/散弾|
|12番/5号|12番|5号|12番/散弾|
|12番/7.5号|12番|7.5号|12番/散弾|
|12番/9号|12番|9号|12番/散弾|
|5.5mm/pellet|5.5mm|pellet|5.5mm/pellet|

### place

`place`シートの`place`テーブルの`place`フィールドから選択する。
`type`フィールドには[射撃場, 銃砲店]が入力される。購入の場合は"銃砲店"でフィルタした`place`を購入店のオプションとする。用途が射撃の場合は"射撃場"でフィルタした`place`を消費場所のオプションとする。

`place`テーブルの例：

|place|type|
|-----|------|
|東海火薬銃砲店|銃砲店|
|中京火薬銃砲店|銃砲店|
|富士国際岩本山総合射撃場|銃砲店|
|富士国際岩本山総合射撃場|射撃場|
|愛知県総合射撃場|射撃場|
|土岐市総合射撃場|射撃場|
|関国際射撃場|射撃場|

### gun

`gun`シートの`gun`テーブルの`gun`フィールドから選択する。

`gun`テーブルの例：

|gun|type|size|
|---|----|----|
|M500|散弾銃|12|
|バイパー|空気銃|5.5|

### use

`use`シートの`use`テーブルの`use`フィールドから選択する。

`use`テーブルの例：

|use|
|---|
|射撃|
|狩猟|
|有害鳥獣駆除|
|有害鳥獣駆除（指定管理）|
